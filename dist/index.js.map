{"version":3,"file":"index.js","sources":["../src/checkFormat.js","../src/style.js","../src/prettiest.js"],"sourcesContent":["import fs from \"fs\"\n\nconst { resolveConfig, getFileInfo, check } = require(\"prettier\")\n\nexport const STATUS_IGNORED = \"ignored\"\nexport const STATUS_PRETTY = \"pretty\"\nexport const STATUS_UGLY = \"ugly\"\nexport const STATUS_ERRORED = \"errored\"\n\nexport const checkFormat = async ({ folder, filenameRelativeArray, afterFormat = () => {} }) => {\n  const report = {}\n\n  await Promise.all(\n    filenameRelativeArray.map(async (filenameRelative) => {\n      const filename = `${folder}/${filenameRelative}`\n      let status\n      let statusDetail\n\n      try {\n        const [source, options, info] = await Promise.all([\n          getFileContentAsString(filename),\n          resolveConfig(filename),\n          getFileInfo(filename),\n        ])\n\n        const { ignored } = info\n        if (ignored) {\n          status = STATUS_IGNORED\n        } else {\n          const pretty = check(source, { ...options, filepath: filename })\n          status = pretty ? STATUS_PRETTY : STATUS_UGLY\n        }\n      } catch (e) {\n        status = STATUS_ERRORED\n        statusDetail = e\n      }\n\n      afterFormat({ filenameRelative, status, statusDetail })\n      report[filenameRelative] = { status, statusDetail }\n    }),\n  )\n\n  return report\n}\n\nconst getFileContentAsString = (pathname) =>\n  new Promise((resolve, reject) => {\n    fs.readFile(pathname, (error, buffer) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(buffer.toString())\n      }\n    })\n  })\n","const close = \"\\x1b[0m\"\nconst green = \"\\x1b[32m\"\nconst red = \"\\x1b[31m\"\nconst blue = \"\\x1b[34m\"\nconst yellow = \"\\x1b[33m\"\n\nexport const erroredStyle = (string) => `${red}${string}${close}`\nexport const erroredStyleWithIcon = (string) => erroredStyle(`${erroredIcon} ${string}`)\nconst erroredIcon = \"\\u003F\" // question mark ?\n\nexport const ignoredStyle = (string) => `${blue}${string}${close}`\nexport const ignoredStyleWithIcon = (string) => ignoredStyle(`${ignoredIcon} ${string}`)\nconst ignoredIcon = \"\\u003F\" // question mark ?\n\nexport const uglyStyle = (string) => `${yellow}${string}${close}`\nexport const uglyStyleWithIcon = (string) => uglyStyle(`${uglyIcon} ${string}`)\nconst uglyIcon = \"\\u2613\" // cross ☓\n\nexport const prettyStyle = (string) => `${green}${string}${close}`\nexport const prettyStyleWithIcon = (string) => prettyStyle(`${prettyIcon} ${string}`)\nconst prettyIcon = \"\\u2714\" // checkmark ✔\n","import {\n  checkFormat,\n  STATUS_ERRORED,\n  STATUS_IGNORED,\n  STATUS_UGLY,\n  STATUS_PRETTY,\n} from \"./checkFormat.js\"\nimport {\n  erroredStyle,\n  ignoredStyle,\n  uglyStyle,\n  prettyStyle,\n  erroredStyleWithIcon,\n  ignoredStyleWithIcon,\n  uglyStyleWithIcon,\n  prettyStyleWithIcon,\n} from \"./style.js\"\n\nexport const prettiest = async ({ folder, filenameRelativeArray }) => {\n  console.log(`\n-------------- format check start -----------------\n`)\n\n  const report = await checkFormat({\n    folder,\n    filenameRelativeArray,\n    afterFormat: ({ filenameRelative, status, statusDetail }) => {\n      if (status === STATUS_ERRORED) {\n        console.log(`${filenameRelative} -> ${erroredStyleWithIcon(\"errored\")}`)\n        console.log(statusDetail)\n      }\n\n      if (status === STATUS_IGNORED) {\n        console.log(`${filenameRelative} -> ${ignoredStyleWithIcon(\"ignored\")}`)\n        return\n      }\n\n      if (status === STATUS_UGLY) {\n        console.log(`${filenameRelative} -> ${uglyStyleWithIcon(\"ugly\")}`)\n        return\n      }\n\n      console.log(`${filenameRelative} -> ${prettyStyleWithIcon(\"pretty\")}`)\n    },\n  })\n\n  const erroredArray = filenameRelativeArray.filter(\n    (filenameRelativeArray) => report[filenameRelativeArray].status === STATUS_ERRORED,\n  )\n  const ignoredArray = filenameRelativeArray.filter(\n    (filenameRelativeArray) => report[filenameRelativeArray].status === STATUS_IGNORED,\n  )\n  const uglyArray = filenameRelativeArray.filter(\n    (filenameRelativeArray) => report[filenameRelativeArray].status === STATUS_UGLY,\n  )\n  const prettyArray = filenameRelativeArray.filter(\n    (filenameRelativeArray) => report[filenameRelativeArray].status === STATUS_PRETTY,\n  )\n\n  console.log(`\n-------------- format check result ----------------\n${filenameRelativeArray.length} files format checked\n- ${erroredStyle(`${erroredArray.length} errored`)}\n- ${ignoredStyle(`${ignoredArray.length} ignored`)}\n- ${uglyStyle(`${uglyArray.length} ugly`)}\n- ${prettyStyle(`${prettyArray.length} pretty`)}\n---------------------------------------------------`)\n\n  if (uglyArray.length || erroredArray.length) {\n    process.exit(1)\n  } else {\n    process.exit(0)\n  }\n}\n"],"names":["resolveConfig","getFileInfo","check","require","STATUS_IGNORED","STATUS_PRETTY","STATUS_UGLY","STATUS_ERRORED","checkFormat","folder","filenameRelativeArray","afterFormat","report","Promise","all","map","filenameRelative","filename","status","statusDetail","source","options","info","getFileContentAsString","ignored","pretty","filepath","e","pathname","resolve","reject","fs","readFile","error","buffer","toString","close","green","red","blue","yellow","erroredStyle","string","erroredStyleWithIcon","erroredIcon","ignoredStyle","ignoredStyleWithIcon","ignoredIcon","uglyStyle","uglyStyleWithIcon","uglyIcon","prettyStyle","prettyStyleWithIcon","prettyIcon","prettiest","console","log","erroredArray","filter","ignoredArray","uglyArray","prettyArray","length","process","exit"],"mappings":"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"}