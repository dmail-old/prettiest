{"version":3,"file":"index.js","sources":["../../project-structure/src/ressourceMatch.js","../../project-structure/src/ressourceToMeta.js","../../project-structure/src/ressourceCanContainsMetaMatching.js","../../project-structure/src/forEachRessourceMatching.js","../src/generateReport.js","../src/style.js","../src/prettiest.js","../src/format.js"],"sourcesContent":["// https://git-scm.com/docs/gitignore\n// https://github.com/kaelzhang/node-ignore\n\nconst match = ({\n  patterns,\n  parts,\n  skipPredicate,\n  lastSkipRequired,\n  lastPatternRequired,\n  matchPart,\n  skipUntilStartsMatching = false,\n}) => {\n  let matched\n  let patternIndex = 0\n  let partIndex = 0\n  let matchIndex = 0\n\n  if (patterns.length === 0 && parts.length === 0) {\n    matched = true\n  } else if (patterns.length === 0 && parts.length) {\n    matched = true\n    matchIndex = parts.length\n  } else if (patterns.length && parts.length === 0) {\n    matched = false\n  } else {\n    matched = true\n\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      const pattern = patterns[patternIndex]\n      const part = parts[partIndex]\n      const isSkipPattern = skipPredicate(pattern)\n      const isLastPattern = patternIndex === patterns.length - 1\n      const isLastPart = partIndex === parts.length - 1\n\n      if (isSkipPattern && isLastPart && isLastPattern) {\n        matchIndex += part.length\n        break\n      }\n\n      if (isSkipPattern && isLastPattern && isLastPart === false) {\n        matchIndex += part.length\n        break\n      }\n\n      if (isSkipPattern && isLastPattern === false && isLastPart) {\n        // test next pattern on current part\n        patternIndex++\n        const nextPatternResult = match({\n          patterns: patterns.slice(patternIndex),\n          parts: parts.slice(partIndex),\n          skipPredicate,\n          lastSkipRequired,\n          lastPatternRequired,\n          matchPart,\n        })\n        matched = nextPatternResult.matched\n        patternIndex += nextPatternResult.patternIndex\n        partIndex += nextPatternResult.partIndex\n\n        if (matched && patternIndex === patterns.length - 1) {\n          matchIndex += nextPatternResult.matchIndex\n          break\n        }\n        if (matched && partIndex === parts.length - 1) {\n          matchIndex += nextPatternResult.matchIndex\n          break\n        }\n        if (matched) {\n          matchIndex += nextPatternResult.matchIndex\n          continue\n        }\n\n        // we still increase the matchIndex by the length of the part because\n        // this part has matched even if the full pattern is not satisfied\n        matchIndex += part.length\n        break\n      }\n\n      if (isSkipPattern && isLastPattern === false && isLastPart === false) {\n        // test next pattern on current part\n        patternIndex++\n\n        const skipResult = match({\n          patterns: patterns.slice(patternIndex),\n          parts: parts.slice(partIndex),\n          skipPredicate,\n          lastSkipRequired,\n          lastPatternRequired,\n          matchPart,\n          skipUntilStartsMatching: true,\n        })\n\n        matched = skipResult.matched\n        patternIndex += skipResult.patternIndex\n        partIndex += skipResult.partIndex\n        matchIndex += skipResult.matchIndex\n\n        if (matched && patternIndex === patterns.length - 1) {\n          break\n        }\n        if (matched && partIndex === parts.length - 1) {\n          break\n        }\n        if (matched) {\n          continue\n        }\n        break\n      }\n\n      const partMatch = matchPart(pattern, part)\n      matched = partMatch.matched\n      matchIndex += partMatch.matchIndex\n      if (matched === false && skipUntilStartsMatching) {\n        matchIndex += part.length\n      }\n\n      if (matched && isLastPattern && isLastPart) {\n        break\n      }\n\n      if (matched && isLastPattern && isLastPart === false) {\n        if (lastPatternRequired) {\n          matched = false\n        }\n        break\n      }\n\n      if (matched && isLastPattern === false && isLastPart) {\n        const remainingPatternAreSkip = patterns\n          .slice(patternIndex + 1)\n          .every((pattern) => skipPredicate(pattern))\n\n        if (remainingPatternAreSkip && lastSkipRequired) {\n          matched = false\n          break\n        }\n        if (remainingPatternAreSkip === false) {\n          matched = false\n          break\n        }\n        break\n      }\n\n      if (matched && isLastPattern === false && isLastPart === false) {\n        patternIndex++\n        partIndex++\n        continue\n      }\n\n      if (matched === false && skipUntilStartsMatching && isLastPart === false) {\n        partIndex++ // keep searching for that pattern\n        continue\n      }\n\n      break\n    }\n  }\n\n  return {\n    matched,\n    matchIndex,\n    patternIndex,\n    partIndex,\n  }\n}\n\nexport const ressourceMatch = (pattern, ressource) => {\n  return match({\n    patterns: pattern.split(\"/\"),\n    parts: ressource.split(\"/\"),\n    lastPatternRequired: false,\n    lastSkipRequired: true,\n    skipPredicate: (sequencePattern) => sequencePattern === \"**\",\n    matchPart: (sequencePattern, sequencePart) => {\n      return match({\n        patterns: sequencePattern.split(\"\"),\n        parts: sequencePart.split(\"\"),\n        lastPatternRequired: true,\n        lastSkipRequired: false,\n        skipPredicate: (charPattern) => charPattern === \"*\",\n        matchPart: (charPattern, charSource) => {\n          const matched = charPattern === charSource\n          return {\n            matched,\n            patternIndex: 0,\n            partIndex: 0,\n            matchIndex: matched ? 1 : 0,\n          }\n        },\n      })\n    },\n  })\n}\n","import { ressourceMatch } from \"./ressourceMatch.js\"\n\nexport const ressourceToMeta = (metaMap, ressource) => {\n  return Object.keys(metaMap).reduce((previousMeta, pattern) => {\n    const { matched } = ressourceMatch(pattern, ressource)\n    return matched ? { ...previousMeta, ...metaMap[pattern] } : previousMeta\n  }, {})\n}\n","import { ressourceMatch } from \"./ressourceMatch.js\"\nimport { ressourceToMeta } from \"./ressourceToMeta.js\"\n\nexport const ressourceCanContainsMetaMatching = (metaMap, ressource, predicate) => {\n  if (typeof metaMap !== \"object\") {\n    throw new TypeError(\n      `ressourceCanContainsMetaMatching metaMap must be an object, got ${metaMap}`,\n    )\n  }\n  if (typeof ressource !== \"string\") {\n    throw new TypeError(\n      `ressourceCanContainsMetaMatching ressource must be a string, got ${ressource}`,\n    )\n  }\n  if (typeof predicate !== \"function\") {\n    throw new TypeError(\n      `ressourceCanContainsMetaMatching predicate must be a function, got ${predicate}`,\n    )\n  }\n\n  const matchIndexForRessource = ressource.split(\"/\").join(\"\").length\n  const partialMatch = Object.keys(metaMap).some((pattern) => {\n    const { matched, matchIndex } = ressourceMatch(pattern, ressource)\n    return matched === false && matchIndex >= matchIndexForRessource && predicate(metaMap[pattern])\n  })\n  if (partialMatch) {\n    return true\n  }\n\n  // no partial match satisfies predicate, does it work on a full match ?\n  const meta = ressourceToMeta(metaMap, ressource)\n  return Boolean(predicate(meta))\n}\n","import fs from \"fs\"\nimport { ressourceCanContainsMetaMatching } from \"./ressourceCanContainsMetaMatching.js\"\nimport { ressourceToMeta } from \"./ressourceToMeta.js\"\n\n// TODO: when using node 10.0 convert this to async generator\nexport const forEachRessourceMatching = async ({\n  localRoot,\n  metaMap,\n  predicate,\n  callback = (ressource) => ressource,\n}) => {\n  if (typeof localRoot !== \"string\") {\n    throw new TypeError(`forEachRessourceMatching localRoot must be a string, got ${localRoot}`)\n  }\n  if (typeof metaMap !== \"object\") {\n    throw new TypeError(`forEachRessourceMatching metaMap must be a object, got ${metaMap}`)\n  }\n  if (typeof predicate !== \"function\") {\n    throw new TypeError(`forEachRessourceMatching predicate must be a function, got ${predicate}`)\n  }\n  if (typeof callback !== \"function\") {\n    throw new TypeError(`forEachRessourceMatching callback must be a function, got ${callback}`)\n  }\n\n  const results = []\n  const visitFolder = async (folder) => {\n    const folderAbsolute = folder ? `${localRoot}/${folder}` : localRoot\n\n    const names = await readDirectory(folderAbsolute)\n\n    await Promise.all(\n      names.map(async (name) => {\n        const ressource = folder ? `${folder}/${name}` : name\n\n        const ressourceAbsolute = `${localRoot}/${ressource}`\n        const stat = await readStat(ressourceAbsolute)\n\n        if (stat.isDirectory()) {\n          if (!ressourceCanContainsMetaMatching(metaMap, ressource, predicate)) {\n            return null\n          }\n          return visitFolder(ressource)\n        }\n\n        const meta = ressourceToMeta(metaMap, ressource)\n        if (!predicate(meta)) {\n          return null\n        }\n\n        const result = await callback(ressource, meta)\n        results.push(result)\n        return null\n      }),\n    )\n  }\n\n  await visitFolder()\n\n  return results\n}\n\nconst readDirectory = (dirname) =>\n  new Promise((resolve, reject) => {\n    fs.readdir(dirname, (error, names) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(names)\n      }\n    })\n  })\n\nconst readStat = (filename) =>\n  new Promise((resolve, reject) => {\n    fs.stat(filename, (error, stat) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(stat)\n      }\n    })\n  })\n","import fs from \"fs\"\n\nconst { resolveConfig, getFileInfo, check } = require(\"prettier\")\n\nexport const generateReport = async ({ localRoot, ressources, afterFormat = () => {} }) => {\n  const report = {}\n\n  await Promise.all(\n    ressources.map(async (ressource) => {\n      const file = `${localRoot}/${ressource}`\n      const [source, options, info] = await Promise.all([\n        getFileContentAsString(file),\n        resolveConfig(file),\n        getFileInfo(file),\n      ])\n\n      console.log(ressource, info)\n\n      const { ignored } = info\n      const pretty = ignored ? undefined : check(source, { ...options, filepath: file })\n      afterFormat({ ressource, pretty, ignored })\n      report[ressource] = { pretty, ignored }\n    }),\n  )\n\n  return report\n}\n\nconst getFileContentAsString = (location) =>\n  new Promise((resolve, reject) => {\n    fs.readFile(location, (error, buffer) => {\n      if (error) {\n        reject(error)\n      } else {\n        resolve(buffer.toString())\n      }\n    })\n  })\n","const close = \"\\x1b[0m\"\nconst green = \"\\x1b[32m\"\nconst red = \"\\x1b[31m\"\nconst blue = \"\\x1b[34m\"\n\nexport const prettyStyle = (string) => `${green}${string}${close}`\nexport const prettyStyleWithIcon = (string) => prettyStyle(`${prettyIcon} ${string}`)\nconst prettyIcon = \"\\u2714\" // checkmark ✔\n\nexport const uglyStyle = (string) => `${red}${string}${close}`\nexport const uglyStyleWithIcon = (string) => uglyStyle(`${uglyIcon} ${string}`)\nconst uglyIcon = \"\\u2613\" // cross ☓\n\nexport const ignoredStyle = (string) => `${blue}${string}${close}`\nexport const ignoredStyleWithIcon = (string) => ignoredStyle(`${ignoredIcon} ${string}`)\nconst ignoredIcon = \"\\u003F\" // question mark ?\n","import { generateReport } from \"./generateReport.js\"\nimport {\n  prettyStyle,\n  uglyStyle,\n  ignoredStyle,\n  prettyStyleWithIcon,\n  uglyStyleWithIcon,\n  ignoredStyleWithIcon,\n} from \"./style.js\"\n\nexport const prettiest = async ({ localRoot, ressources }) => {\n  const report = await generateReport({\n    localRoot,\n    ressources,\n    afterFormat: ({ ressource, pretty, ignored }) => {\n      if (ignored) {\n        console.log(`${ressource} -> ${ignoredStyleWithIcon(\"ignored\")}`)\n        return\n      }\n      if (pretty) {\n        console.log(`${ressource} -> ${prettyStyleWithIcon(\"pretty\")}`)\n        return\n      }\n      console.log(`${ressource} -> ${uglyStyleWithIcon(\"ugly\")}`)\n    },\n  })\n\n  const prettyArray = ressources.filter((ressource) => {\n    return !report[ressource].ignored && report[ressource].pretty\n  })\n  const uglyArray = ressources.filter((ressource) => {\n    return !report[ressource].ignored && !report[ressource].pretty\n  })\n  const ignoredArray = ressources.filter((ressource) => {\n    return report[ressource].ignored\n  })\n\n  console.log(\n    `${ressources.length} files:\n- ${prettyStyle(`${prettyArray.length} pretty`)}\n- ${uglyStyle(`${uglyArray.length} ugly`)}\n- ${ignoredStyle(`${ignoredArray.length} ignored`)}`,\n  )\n\n  if (uglyArray.length) {\n    process.exit(1)\n  } else {\n    process.exit(0)\n  }\n}\n","import { forEachRessourceMatching } from \"@dmail/project-structure\"\nimport { prettiest } from \"./prettiest.js\"\n\nexport const format = async ({ localRoot, metaMap }) => {\n  const ressources = await forEachRessourceMatching({\n    localRoot,\n    metaMap,\n    predicate: (meta) => meta.format === true,\n  })\n  return prettiest({ localRoot, ressources })\n}\n"],"names":["match","patterns","parts","skipPredicate","lastSkipRequired","lastPatternRequired","matchPart","skipUntilStartsMatching","matched","patternIndex","partIndex","matchIndex","length","pattern","part","isSkipPattern","isLastPattern","isLastPart","nextPatternResult","slice","skipResult","partMatch","remainingPatternAreSkip","every","ressourceMatch","ressource","split","sequencePattern","sequencePart","charPattern","charSource","ressourceToMeta","metaMap","Object","keys","reduce","previousMeta","ressourceCanContainsMetaMatching","predicate","TypeError","matchIndexForRessource","join","partialMatch","some","meta","Boolean","forEachRessourceMatching","localRoot","callback","results","visitFolder","folder","folderAbsolute","names","readDirectory","Promise","all","map","name","ressourceAbsolute","stat","readStat","isDirectory","result","push","dirname","resolve","reject","fs","readdir","error","filename","resolveConfig","getFileInfo","check","require","generateReport","ressources","afterFormat","report","file","source","options","info","getFileContentAsString","console","log","ignored","pretty","undefined","filepath","location","readFile","buffer","toString","close","green","red","blue","prettyStyle","string","prettyStyleWithIcon","prettyIcon","uglyStyle","uglyStyleWithIcon","uglyIcon","ignoredStyle","ignoredStyleWithIcon","ignoredIcon","prettiest","prettyArray","filter","uglyArray","ignoredArray","process","exit","format"],"mappings":"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"}